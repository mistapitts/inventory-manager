<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Inventory Manager" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#0f0f23" />
    <meta name="msapplication-TileColor" content="#0f0f23" />
    <title>Inventory Manager - Login</title>
    <link rel="stylesheet" href="/styles.css?v=chatgpt-fix-v4" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- Login Form -->
      <div class="login-container" id="loginContainer">
        <div class="login-header">
          <div class="logo">
            <i class="fas fa-clipboard-list"></i>
            <h1>EZ Inventory</h1>
          </div>
          <p class="subtitle">Professional Inventory & Calibration Management</p>
        </div>

        <form class="login-form" id="loginForm">
          <div class="form-group">
            <label for="email">Email Address</label>
            <div class="input-wrapper">
              <i class="fas fa-envelope"></i>
              <input type="email" id="email" name="email" required placeholder="Enter your email" />
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="input-wrapper">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                id="password"
                name="password"
                required
                placeholder="Enter your password"
              />
              <button type="button" class="toggle-password" id="togglePassword">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <div class="form-options">
            <label class="checkbox-wrapper">
              <input type="checkbox" id="rememberMe" />
              <span class="checkmark"></span>
              Stay logged in
            </label>
          </div>

          <button type="submit" class="login-btn">
            <span class="btn-text">Sign In</span>
            <div class="btn-loader" style="display: none">
              <div class="spinner"></div>
            </div>
          </button>
        </form>

        <div class="login-footer">
          <p>Don't have an account? <a href="#" id="showRegister">Create Account</a></p>
          <div class="employee-notice">
            <p>
              <i class="fas fa-info-circle"></i> <strong>Company Employee?</strong> Contact your
              manager or IT administrator to request access to your organization's inventory system.
            </p>
          </div>
          <p class="support-link">
            <a href="#"><i class="fas fa-question-circle"></i> Need help?</a>
          </p>
        </div>
      </div>

      <!-- Registration Form -->
      <div class="register-container" id="registerContainer" style="display: none">
        <div class="register-header">
          <button class="back-btn" id="backToLogin">
            <i class="fas fa-arrow-left"></i> Back to Login
          </button>
          <h2>Create Account</h2>
          <p>Enter your invite code to join your company</p>
        </div>

        <form class="register-form" id="registerForm">
          <div class="form-group">
            <label for="regEmail">Email Address</label>
            <div class="input-wrapper">
              <i class="fas fa-envelope"></i>
              <input
                type="email"
                id="regEmail"
                name="email"
                required
                placeholder="Enter your email"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="firstName">First Name</label>
            <div class="input-wrapper">
              <i class="fas fa-user"></i>
              <input
                type="text"
                id="firstName"
                name="firstName"
                required
                placeholder="Enter your first name"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="lastName">Last Name</label>
            <div class="input-wrapper">
              <i class="fas fa-user"></i>
              <input
                type="text"
                id="lastName"
                name="lastName"
                required
                placeholder="Enter your last name"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="inviteCode">Invite Code</label>
            <div class="input-wrapper">
              <i class="fas fa-key"></i>
              <input
                type="text"
                id="inviteCode"
                name="inviteCode"
                required
                placeholder="Enter your company invite code"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="regPassword">Password</label>
            <div class="input-wrapper">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                id="regPassword"
                name="password"
                required
                placeholder="Create a password"
              />
              <button type="button" class="toggle-password" id="toggleRegPassword">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <button type="submit" class="register-btn">
            <span class="btn-text">Create Account</span>
            <div class="btn-loader" style="display: none">
              <div class="spinner"></div>
            </div>
          </button>
        </form>
      </div>

      <!-- Invite Confirmation Page -->
      <div class="invite-confirm-container" id="inviteConfirmContainer" style="display: none">
        <div class="invite-confirm-header">
          <div class="company-welcome">
            <i class="fas fa-building"></i>
            <h2>You're Invited!</h2>
            <p id="companyWelcomeText">Join [Company Name] on Inventory Manager</p>
          </div>
        </div>

        <div class="invite-info-card">
          <h3>Account Details</h3>
          <div class="invite-details">
            <div class="detail-row">
              <label>Name:</label>
              <span id="inviteFullName">[Name]</span>
            </div>
            <div class="detail-row">
              <label>Email:</label>
              <span id="inviteEmail">[Email]</span>
            </div>
            <div class="detail-row">
              <label>Role:</label>
              <span id="inviteRole">[Role]</span>
            </div>
            <div class="detail-row">
              <label>Company:</label>
              <span id="inviteCompany">[Company]</span>
            </div>
          </div>
        </div>

        <form class="invite-confirm-form" id="inviteConfirmForm">
          <input type="hidden" id="confirmInviteCode" />

          <div class="form-group">
            <label for="confirmPassword">Choose Your Password</label>
            <div class="input-wrapper">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                id="confirmPassword"
                name="password"
                required
                placeholder="Enter a secure password"
                minlength="6"
              />
              <button type="button" class="toggle-password" id="toggleConfirmPassword">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <small class="form-help">Minimum 6 characters</small>
          </div>

          <div class="invite-actions">
            <button type="button" class="btn btn-secondary" id="cancelInviteBtn">
              <i class="fas fa-times"></i> Cancel Invitation
            </button>
            <button type="submit" class="btn btn-primary">
              <span class="btn-text"> <i class="fas fa-check"></i> Accept & Create Account </span>
              <div class="btn-loader" style="display: none">
                <div class="spinner"></div>
              </div>
            </button>
          </div>
        </form>

        <div class="invite-footer">
          <p>
            <i class="fas fa-shield-alt"></i> Your information is secure and will only be used for
            account creation.
          </p>
        </div>
      </div>

      <!-- Export Inventory Modal -->
      <div id="modal-export-inventory" class="modal hidden">
        <div class="modal-card">
          <h3><i class="fas fa-download"></i> Export Inventory</h3>
          <p class="modal-description">Choose which items to include in your Excel export:</p>

          <div class="export-options">
            <div class="export-option">
              <input type="radio" id="exportAll" name="exportType" value="all" checked />
              <label for="exportAll">
                <div class="option-content">
                  <div class="option-header">
                    <i class="fas fa-list"></i>
                    <strong>Export All Items</strong>
                  </div>
                  <p class="option-description">
                    Export all inventory items regardless of current filters or search
                  </p>
                  <span class="item-count" id="allItemsCount">0 items</span>
                </div>
              </label>
            </div>

            <div class="export-option">
              <input type="radio" id="exportVisible" name="exportType" value="visible" />
              <label for="exportVisible">
                <div class="option-content">
                  <div class="option-header">
                    <i class="fas fa-filter"></i>
                    <strong>Export Visible Items Only</strong>
                  </div>
                  <p class="option-description">
                    Export only the items currently shown in the table (filtered results)
                  </p>
                  <span class="item-count" id="visibleItemsCount">0 items</span>
                </div>
              </label>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" data-close="modal-export-inventory">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button type="button" class="btn btn-primary" id="confirmExportBtn">
              <i class="fas fa-file-excel"></i> Export to Excel
            </button>
          </div>
        </div>
      </div>

      <!-- Dashboard (hidden until login) -->
      <div class="dashboard" id="dashboard" style="display: none">
        <nav class="sidebar">
          <div class="sidebar-header">
            <div class="logo">
              <i class="fas fa-clipboard-list"></i>
              <span>EZ Inventory</span>
            </div>
          </div>

          <ul class="nav-menu">
            <li class="nav-item active">
              <a href="#inventory" class="nav-link">
                <i class="fas fa-boxes"></i>
                <span>Inventory</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#calendar" class="nav-link">
                <i class="fas fa-calendar-alt"></i>
                <span>Calendar</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#company" class="nav-link">
                <i class="fas fa-building"></i>
                <span>My Company</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#reports" class="nav-link">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#settings" class="nav-link">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#support" class="nav-link">
                <i class="fas fa-question-circle"></i>
                <span>Support</span>
              </a>
            </li>
          </ul>

          <div class="sidebar-footer">
            <div class="user-info">
              <div class="user-avatar">
                <i class="fas fa-user"></i>
              </div>
              <div class="user-details">
                <span class="user-name" id="userName">Admin User</span>
                <span class="user-role" id="userRole">Administrator</span>
              </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
        </nav>

        <main class="main-content">
          <header class="top-bar">
            <div class="breadcrumb">
              <span>Inventory</span>
            </div>
            <div class="top-actions">
              <div class="search-container">
                <div class="search-box">
                  <i class="fas fa-search"></i>
                  <label for="searchInventory" class="visually-hidden">Search inventory</label>
                  <input
                    type="text"
                    id="searchInventory"
                    name="searchInventory"
                    placeholder="Search inventory..."
                    autocomplete="off"
                  />
                </div>
                <div class="search-results-popup" id="searchResultsPopup" style="display: none">
                  <span class="search-count" id="searchCount">0 matches</span>
                  <div class="search-navigation">
                    <button class="search-nav-btn" id="searchPrevBtn" title="Previous match">
                      <i class="fas fa-chevron-up"></i>
                    </button>
                    <button class="search-nav-btn" id="searchNextBtn" title="Next match">
                      <i class="fas fa-chevron-down"></i>
                    </button>
                  </div>
                </div>
              </div>
              <button class="add-item-btn" id="addItemBtn">
                <i class="fas fa-plus"></i>
                Add Item
              </button>
              <button class="btn btn-primary" id="createListBtn">
                <i class="fas fa-list"></i>
                Create List
              </button>
              <button class="btn btn-secondary" id="exportInventoryBtn">
                <i class="fas fa-download"></i>
                Export Inventory
              </button>
            </div>
          </header>

          <div class="content-area">
            <!-- Welcome Message (shown when no items) -->
            <div class="welcome-message" id="welcomeMessage">
              <h2>Welcome to EZ Inventory</h2>
              <p>
                Your inventory dashboard is ready. Start by setting up your first location to organize your inventory.
              </p>
              <button id="setupFirstLocationBtn" class="btn btn-primary">
                <i class="fas fa-map-marker-alt"></i> Setup First Location
              </button>
              <button
                id="createFirstListBtn"
                class="btn btn-secondary"
                style="display: none; margin-left: 12px"
              >
                <i class="fas fa-list"></i> Create First List
              </button>
            </div>

            <!-- Quick Stats -->
            <div class="quick-stats">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-content">
                  <h3 id="totalItems">0</h3>
                  <p>Total Items</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-content">
                  <h3 id="dueThisMonth">0</h3>
                  <p>Due This Month</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-tools"></i>
                </div>
                <div class="stat-content">
                  <h3 id="maintenanceDue">0</h3>
                  <p>Maintenance Due</p>
                </div>
              </div>
            </div>

            <!-- Inventory List (shown when items exist) -->
            <div class="inventory-section" id="inventorySection" style="display: none">
              <!-- Main content area with edit button on the right -->
              <div class="inventory-content-wrapper">
                <!-- Left side content -->
                <div class="inventory-main-content">
                  <div class="list-controls">
                    <button
                      class="btn btn-secondary"
                      id="migrateToFieldBtn"
                      onclick="migrateItemsToFieldList()"
                      style="display: none"
                    >
                      <i class="fas fa-arrow-right"></i> Migrate to Field
                    </button>
                  </div>
                </div>

                <!-- Edit Lists Button positioned where old legend was -->
                <div class="inventory-sidebar">
                  <button
                    class="column-customizer-btn"
                    id="columnCustomizerBtn"
                    title="Edit Lists and Columns"
                  >
                    <i class="fas fa-columns"></i> Edit Lists and Columns
                  </button>
                  <div class="column-customizer-menu" id="columnCustomizerMenu">
                    <!-- Lists Section -->
                    <div class="column-customizer-header">
                      <h4>Lists</h4>
                      <button class="reset-columns-btn" id="listsShowAllBtn">Show All</button>
                    </div>
                    <div class="list-options" id="listOptions"></div>
                    <div class="menu-footer">
                      <button class="reset-columns-btn" id="addListInlineBtn">
                        + Add List
                      </button>
                    </div>

                    <!-- Columns Section -->
                    <div class="column-customizer-header">
                      <h4>Visible Columns</h4>
                      <button class="reset-columns-btn" onclick="resetColumnVisibility()">
                        Reset All
                      </button>
                    </div>
                    <div class="column-options">
                      <label class="column-option">
                        <input type="checkbox" data-column="itemType" checked /> Item Type
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="nickname" checked /> Nickname
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="labId" checked /> Lab ID
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="make" checked /> Make
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="model" checked /> Model
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="serialNumber" checked /> Serial #
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="condition" checked /> Condition
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="dateReceived" checked /> Date
                        Received
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="datePlacedInService" checked /> In
                        Service
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="location" checked /> Where to Find
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="calibrationType" checked /> Cal
                        Type
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="calibrationDate" checked /> Last
                        Cal
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="nextCalibrationDue" checked />
                        Next Cal Due
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="calibrationInterval" checked />
                        Cal Interval
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="calibrationMethod" checked /> Cal
                        Method/Company
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="maintenanceDate" checked /> Last
                        Maintenance
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="maintenanceDue" checked />
                        Maintenance Due
                      </label>
                      <label class="column-option">
                        <input type="checkbox" data-column="notes" checked /> Notes
                      </label>
                    </div>

                    <!-- OOS Visibility Section -->
                    <div class="column-customizer-header">
                      <h4>Out of Service</h4>
                    </div>
                    <div class="mt-3" id="oos-visibility-block">
                      <label class="column-option">
                        <input type="checkbox" id="drawerShowOOS" checked />
                        Show Out of Service items
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="inventory-main-content">
                <div class="inventory-table-container">
                  <!-- Location Header -->
                  <div class="location-header" id="locationHeader" style="display: none;">
                    <div class="location-info">
                      <h2 class="location-name" id="currentLocationName">Main Office</h2>
                      <button class="btn btn-secondary btn-sm" id="changeLocationBtn" title="Switch Location">
                        <i class="fas fa-exchange-alt"></i> Change Location
                      </button>
                    </div>
                  </div>

                  <!-- Fixed toolbar (never scrolls) -->
                  <div class="inventory-table-header">
                    <h3 class="inventory-table-title">Inventory</h3>
                    <div class="table-header-legend" id="tableHeaderLegend">
                      <div class="legend-item">
                        <span class="chip chip-oos">OOS</span>
                        <span class="legend-label">Out of Service</span>
                      </div>
                      <div class="legend-item">
                        <span class="chip chip-outsourced">OSC</span>
                        <span class="legend-label">Outsourced</span>
                      </div>
                      <div class="legend-lists" id="tableHeaderLegendLists"></div>
                    </div>
                  </div>

                  <!-- Top scrollbar for horizontal navigation -->
                  <div class="table-scrollbar-top" id="tableScrollbarTop">
                    <div class="scrollbar-content"></div>
                  </div>

                  <!-- Only this part scrolls -->
                  <div class="inventory-table-scroll-wrapper" id="inventoryTableScrollWrapper">
                    <table class="inventory-table" id="inventoryTable">
                      <thead>
                        <tr>
                          <th class="status-column"></th>
                          <th class="sortable" data-sort="itemType">
                            Item Type <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="nickname">
                            Nickname <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="labId">
                            Lab ID <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="make">
                            Make <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="model">
                            Model <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="serialNumber">
                            Serial # <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="condition">
                            Condition <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="dateReceived">
                            Date Received <i class="fas fa-sort"></i>
                          </th>

                          <th class="sortable" data-sort="location">
                            Where to Find <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="calibrationDate">
                            Last Cal <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="nextCalibrationDue">
                            Next Cal Due <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="calibrationInterval">
                            Cal Interval <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="calibrationMethod">
                            Cal Method/Company <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="maintenanceDate">
                            Last Maintenance <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="maintenanceDue">
                            Maintenance Due <i class="fas fa-sort"></i>
                          </th>
                          <th class="sortable" data-sort="notes">
                            Notes <i class="fas fa-sort"></i>
                          </th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="inventoryTableBody">
                        <!-- Inventory items will be populated here -->
                      </tbody>
                    </table>
                  </div>
                  <!-- Close inventory-table-scroll-wrapper -->
                </div>
              </div>
            </div>
            <!-- Close inventory-main-content -->

            <!-- Calendar Section (hidden until calendar nav is selected) -->
            <div class="calendar-section" id="calendarSection" style="display: none"></div>

            <!-- My Company Section -->
            <div class="company-section" id="companySection" style="display: none">
              <div class="section-header">
                <h2>My Company</h2>
              </div>

              <div class="company-content">
                <div class="company-grid">
                  <!-- Company Information -->
                  <div class="company-card company-info-card">
                    <div class="company-card-header">
                      <h3><i class="fas fa-building"></i> Company Information</h3>
                      <button class="btn btn-secondary btn-sm" id="editCompanyBtn">
                        <i class="fas fa-edit"></i> Edit
                      </button>
                    </div>
                    <div class="company-card-content" id="companyInfoContent">
                      <!-- Company info will be populated here -->
                    </div>
                  </div>

                  <!-- Company Logo & Color Settings Row -->
                  <div class="company-card">
                    <div class="company-card-header">
                      <h3><i class="fas fa-image"></i> Company Logo</h3>
                    </div>
                    <div class="company-card-content">
                      <div class="logo-upload-area" id="logoUploadArea">
                        <div class="current-logo" id="currentLogo">
                          <img
                            id="companyLogoImg"
                            src=""
                            alt="Company Logo"
                            style="
                              display: none;
                              max-width: 200px;
                              max-height: 100px;
                              object-fit: contain;
                            "
                          />
                          <div class="no-logo" id="noLogoPlaceholder">
                            <i class="fas fa-building fa-3x"></i>
                            <p>No logo uploaded</p>
                          </div>
                        </div>
                        <input
                          type="file"
                          id="logoFileInput"
                          accept="image/*"
                          style="display: none"
                        />
                        <button class="btn btn-primary" id="uploadLogoBtn">
                          <i class="fas fa-upload"></i> Upload Logo
                        </button>
                        <button class="btn btn-secondary" id="removeLogoBtn" style="display: none">
                          <i class="fas fa-trash"></i> Remove Logo
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Company Color Settings -->
                  <div class="company-card">
                    <div class="company-card-header">
                      <h3><i class="fas fa-palette"></i> Company Color Settings</h3>
                    </div>
                    <div class="company-card-content">
                      <div class="form-group">
                        <label>Company Theme</label>
                        <select id="companyTheme" class="input">
                          <option value="dark">Dark Theme (Default)</option>
                          <option value="light">Light Theme (Coming Soon)</option>
                          <option value="blue">Blue Theme (Coming Soon)</option>
                        </select>
                      </div>
                      <button class="btn btn-secondary" disabled>
                        <i class="fas fa-save"></i> Save Settings (Coming Soon)
                      </button>
                    </div>
                  </div>

                  <!-- User Management -->
                  <div class="company-card company-users-card">
                    <div class="company-card-header">
                      <h3><i class="fas fa-users"></i> Company Users</h3>
                      <button class="btn btn-primary btn-sm" id="inviteUserBtn">
                        <i class="fas fa-user-plus"></i> Invite User
                      </button>
                    </div>
                    <div class="company-card-content">
                      <div class="users-list" id="companyUsersList">
                        <!-- Users will be populated here -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Settings Section -->
            <div class="settings-section" id="settingsSection" style="display: none">
              <div class="section-header">
                <h2>Settings</h2>
              </div>

              <div class="settings-content">
                <div class="settings-grid">
                  <!-- Profile Settings (Admin/Company Owner only) -->
                  <div class="settings-card" id="profileSettingsCard">
                    <div class="settings-card-header">
                      <h3><i class="fas fa-user"></i> Profile Settings</h3>
                      <p>Manage your account information</p>
                    </div>
                    <div class="settings-card-content">
                      <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="profileFirstName" class="input" />
                      </div>
                      <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="profileLastName" class="input" />
                      </div>
                      <div class="form-group">
                        <label>Email</label>
                        <input
                          type="email"
                          id="profileEmail"
                          class="input"
                          readonly
                          autocomplete="username"
                        />
                        <small class="form-help">Email cannot be changed</small>
                      </div>

                      <button class="btn btn-primary" id="saveProfileBtn">
                        <i class="fas fa-save"></i> Save Changes
                      </button>
                    </div>
                  </div>

                  <!-- Password Settings -->
                  <div class="settings-card" id="passwordSettingsCard">
                    <div class="settings-card-header">
                      <h3><i class="fas fa-lock"></i> Change Password</h3>
                      <p>Update your account password</p>
                    </div>
                    <div class="settings-card-content">
                      <form id="changePasswordForm" autocomplete="off">
                        <!-- Hidden username field for password managers -->
                        <input
                          type="email"
                          id="hiddenUsername"
                          style="display: none"
                          autocomplete="username"
                        />

                        <div class="form-group">
                          <label>Current Password</label>
                          <input
                            type="password"
                            id="currentPassword"
                            class="input"
                            autocomplete="current-password"
                          />
                        </div>
                        <div class="form-group">
                          <label>New Password</label>
                          <input
                            type="password"
                            id="newPassword"
                            class="input"
                            autocomplete="new-password"
                          />
                        </div>
                        <div class="form-group">
                          <label>Confirm New Password</label>
                          <input
                            type="password"
                            id="confirmNewPassword"
                            class="input"
                            autocomplete="new-password"
                          />
                        </div>
                        <button type="button" class="btn btn-primary" id="changePasswordBtn">
                          <i class="fas fa-key"></i> Change Password
                        </button>
                      </form>
                    </div>
                  </div>


                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Edit Company Modal -->
    <div id="modal-edit-company" class="modal hidden">
      <div class="modal-card" style="max-width: 600px">
        <h3>Edit Company Information</h3>
        <form id="form-edit-company">
          <div class="form-row">
            <div class="form-group">
              <label>Company Name <span class="text-red-400">*</span></label>
              <input type="text" id="edit-company-name" class="input" required />
            </div>
            <div class="form-group">
              <label>Phone</label>
              <input type="tel" id="edit-company-phone" class="input" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="edit-company-email" class="input" />
            </div>
            <div class="form-group">
              <label>Website</label>
              <input type="url" id="edit-company-website" class="input" placeholder="https://" />
            </div>
          </div>

          <div class="form-group">
            <label>Address</label>
            <input type="text" id="edit-company-address" class="input" />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" id="edit-company-city" class="input" />
            </div>
            <div class="form-group">
              <label>State</label>
              <input type="text" id="edit-company-state" class="input" />
            </div>
            <div class="form-group">
              <label>ZIP Code</label>
              <input type="text" id="edit-company-zip" class="input" />
            </div>
          </div>

          <div class="form-group">
            <label>Country</label>
            <input type="text" id="edit-company-country" class="input" value="United States" />
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea
              id="edit-company-description"
              class="textarea"
              rows="3"
              placeholder="Brief description of your company..."
            ></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" data-close="modal-edit-company">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Setup First Location Modal -->
    <div id="modal-setup-first-location" class="modal hidden">
      <div class="modal-card" style="max-width: 600px">
        <h3><i class="fas fa-map-marker-alt"></i> Setup First Location</h3>
        <p class="modal-description">Create your first office/branch location to organize your inventory.</p>
        <form id="form-setup-first-location">
          <div class="form-row">
            <div class="form-group">
              <label>Location Name <span class="text-red-400">*</span></label>
              <input type="text" id="setup-location-name" class="input" required placeholder="e.g., Main Office, Lab A, Branch 1" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Address</label>
              <input type="text" id="setup-location-address" class="input" placeholder="Street address" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" id="setup-location-city" class="input" placeholder="City" />
            </div>
            <div class="form-group">
              <label>State</label>
              <input type="text" id="setup-location-state" class="input" placeholder="State" />
            </div>
            <div class="form-group">
              <label>ZIP Code</label>
              <input type="text" id="setup-location-zip" class="input" placeholder="ZIP" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" id="setup-location-phone" class="input" placeholder="(555) 123-4567" />
            </div>
            <div class="form-group">
              <label>Branch Manager</label>
              <input type="text" id="setup-location-manager" class="input" placeholder="Manager name" />
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="hideSetupFirstLocationModal()">Cancel</button>
            <button type="submit" class="btn-primary">
              <i class="fas fa-check"></i> Create Location
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Location Selection Modal -->
    <div id="modal-select-location" class="modal hidden">
      <div class="modal-card" style="max-width: 500px">
        <h3><i class="fas fa-map-marker-alt"></i> Select Location</h3>
        <p class="modal-description">Choose which location's inventory to view and manage.</p>
        
        <div class="location-list" id="locationList">
          <!-- Locations will be populated here -->
          <div class="location-option">
            <div class="location-option-info">
              <h4>Loading locations...</h4>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="hideSelectLocationModal()">Cancel</button>
          <button type="button" class="btn btn-primary" id="addNewLocationBtn">
            <i class="fas fa-plus"></i> Add New Location
          </button>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div id="modal-edit-user" class="modal hidden">
      <div class="modal-card" style="max-width: 700px">
        <h3><i class="fas fa-user-edit"></i> Edit User</h3>
        <form id="form-edit-user">
          <input type="hidden" id="edit-user-id" />
          
          <div class="form-row">
            <div class="form-group">
              <label>First Name <span class="text-red-400">*</span></label>
              <input type="text" id="edit-user-first-name" class="input" required />
            </div>
            <div class="form-group">
              <label>Last Name <span class="text-red-400">*</span></label>
              <input type="text" id="edit-user-last-name" class="input" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="edit-user-email" class="input" readonly />
              <small class="form-help">Email cannot be changed</small>
            </div>
            <div class="form-group">
              <label>Employee ID</label>
              <input type="text" id="edit-user-employee-id" class="input" placeholder="Optional employee/badge number" />
            </div>
          </div>

          <div class="form-group">
            <label>Role <span class="text-red-400">*</span></label>
            <select id="edit-user-role" class="input" required>
              <option value="">Select a role...</option>
              <option value="company_account_admin">Company Account Admin</option>
              <option value="company_owner">Company Owner</option>
              <option value="company_admin">Company Admin</option>
              <option value="manager">Manager</option>
              <option value="user">User</option>
              <option value="viewer">Viewer</option>
            </select>
          </div>

          <div class="form-group">
            <label>Location Assignments</label>
            <div class="location-assignments" id="userLocationAssignments">
              <!-- Location assignments will be populated here -->
            </div>
            <button type="button" class="btn btn-secondary btn-sm" id="addLocationAssignmentBtn">
              <i class="fas fa-plus"></i> Add Location
            </button>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="hideEditUserModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Invite User Modal -->
    <div id="modal-invite-user" class="modal hidden">
      <div class="modal-card">
        <h3>Invite New User</h3>
        <form id="form-invite-user">
          <div class="form-group">
            <label>Email Address <span class="text-red-400">*</span></label>
            <input type="email" id="invite-user-email" class="input" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>First Name <span class="text-red-400">*</span></label>
              <input type="text" id="invite-user-first-name" class="input" required />
            </div>
            <div class="form-group">
              <label>Last Name <span class="text-red-400">*</span></label>
              <input type="text" id="invite-user-last-name" class="input" required />
            </div>
          </div>

          <div class="form-group">
            <label>Employee ID</label>
            <input type="text" id="invite-user-employee-id" class="input" placeholder="Optional employee/badge number" />
          </div>

          <div class="form-group">
            <label>Role <span class="text-red-400">*</span></label>
            <select id="invite-user-role" class="input" required>
              <option value="">Select a role...</option>
              <option value="company_account_admin">Company Account Admin</option>
              <option value="company_owner">Company Owner</option>
              <option value="company_admin">Company Admin</option>
              <option value="manager">Manager</option>
              <option value="user">User</option>
              <option value="viewer">Viewer</option>
            </select>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" data-close="modal-invite-user">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-paper-plane"></i> Send Invitation
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Notification Toast -->
    <div class="toast" id="toast"></div>

    <!-- Add Item Modal -->
    <div class="modal-overlay" id="addItemModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Inventory Item</h2>
          <button class="modal-close" id="closeAddItemModal">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form class="add-item-form" id="addItemForm">
          <div class="form-sections">
            <!-- Basic Information -->
            <div class="form-section">
              <h3>Basic Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="itemType">Item Type *</label>
                  <input
                    type="text"
                    id="itemType"
                    name="itemType"
                    required
                    placeholder="e.g., Scale, Caliper, Vibration Analyzer"
                  />
                </div>
                <div class="form-group">
                  <label for="nickname">Nickname</label>
                  <input
                    type="text"
                    id="nickname"
                    name="nickname"
                    placeholder="e.g., Main Lab Scale"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="listId">List</label>
                  <select id="listId" name="listId">
                    <option value="">No lists available</option>
                  </select>
                  <button
                    type="button"
                    id="createListFromForm"
                    class="btn-secondary"
                    style="margin-top: 8px; display: none"
                  >
                    <i class="fas fa-plus"></i> Create New List
                  </button>
                </div>
                <div class="form-group">
                  <!-- spacer -->
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="labId">Lab ID/Number</label>
                  <input type="text" id="labId" name="labId" placeholder="e.g., LAB-001" />
                </div>
                <div class="form-group">
                  <label for="make">Make *</label>
                  <input
                    type="text"
                    id="make"
                    name="make"
                    required
                    placeholder="e.g., Mettler Toledo"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="model">Model *</label>
                  <input type="text" id="model" name="model" required placeholder="e.g., XS205" />
                </div>
                <div class="form-group">
                  <label for="serialNumber">Serial Number *</label>
                  <input
                    type="text"
                    id="serialNumber"
                    name="serialNumber"
                    required
                    placeholder="e.g., SN123456"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="condition">Condition When Received *</label>
                  <select id="condition" name="condition" required>
                    <option value="">Select Condition</option>
                    <option value="new">New</option>
                    <option value="used">Used</option>
                    <option value="refurbished">Refurbished</option>
                  </select>
                </div>
                <div class="form-group">
                  <!-- Empty div for spacing -->
                </div>
              </div>
            </div>

            <!-- Dates and Location -->
            <div class="form-section">
              <h3>Dates and Location</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="dateReceived">Date Received *</label>
                  <input type="date" id="dateReceived" name="dateReceived" required />
                </div>
                <div class="form-group">
                  <label for="datePlacedInService">Date Placed in Service *</label>
                  <input type="date" id="datePlacedInService" name="datePlacedInService" required />
                </div>
              </div>

              <div class="form-group">
                <label for="location">Where to Find *</label>
                <input
                  type="text"
                  id="location"
                  name="location"
                  required
                  placeholder="e.g., Main Lab, Field Truck #1, Lab 3 - Bench 2"
                />
              </div>
            </div>

            <!-- Calibration Information -->
            <div class="form-section">
              <h3>Calibration Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="calibrationType">Calibration Type *</label>
                  <select id="calibrationType" name="calibrationType" required>
                    <option value="">Select Type</option>
                    <option value="in_house">In-House</option>
                    <option value="outsourced">Outsourced</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="calibrationDate">Last Calibration Date *</label>
                  <input type="date" id="calibrationDate" name="calibrationDate" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="nextCalibrationDue">Next Calibration Due *</label>
                  <input type="date" id="nextCalibrationDue" name="nextCalibrationDue" required />
                </div>
                <div class="form-group">
                  <label for="calibrationInterval">Calibration Interval *</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="calibrationInterval"
                      name="calibrationInterval"
                      required
                      min="1"
                      max="365"
                      value="12"
                    />
                    <select id="calibrationIntervalType" name="calibrationIntervalType" required>
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="calibrationMethod" id="calibrationMethodLabel"
                  >Calibration Method *</label
                >
                <input
                  type="text"
                  id="calibrationMethod"
                  name="calibrationMethod"
                  required
                  placeholder="e.g., ASTM D4753"
                />
              </div>

              <!-- Calibration Files -->
              <div class="file-upload-section">
                <label>Calibration Files</label>
                <div class="file-upload-group">
                  <div class="file-upload">
                    <label for="calibrationTemplate">Calibration Template</label>
                    <input
                      type="file"
                      id="calibrationTemplate"
                      name="calibrationTemplate"
                      accept=".pdf,.doc,.docx,.xls,.xlsx"
                    />
                    <span class="file-info">Upload template form</span>
                  </div>
                  <div class="file-upload">
                    <label for="calibrationInstructions">Calibration Instructions</label>
                    <input
                      type="file"
                      id="calibrationInstructions"
                      name="calibrationInstructions"
                      accept=".pdf,.doc,.docx,.xls,.xlsx"
                    />
                    <span class="file-info">Upload procedure</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Maintenance Information -->
            <div class="form-section">
              <h3>Maintenance Information</h3>
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="useMaintenance" name="useMaintenance" />
                  <span class="checkmark"></span>
                  Include maintenance tracking for this item
                </label>
              </div>

              <div id="maintenanceFields" style="display: none">
                <div class="form-row">
                  <div class="form-group">
                    <label for="maintenanceDate">Last Maintenance Date</label>
                    <input type="date" id="maintenanceDate" name="maintenanceDate" />
                  </div>
                  <div class="form-group">
                    <label for="maintenanceDue">Next Maintenance Due</label>
                    <input type="date" id="maintenanceDue" name="maintenanceDue" />
                  </div>
                </div>

                <div class="form-group">
                  <label for="maintenanceInterval">Maintenance Interval</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="maintenanceInterval"
                      name="maintenanceInterval"
                      min="1"
                      max="365"
                      value="6"
                    />
                    <select id="maintenanceIntervalType" name="maintenanceIntervalType">
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>

                <!-- Maintenance Files -->
                <div class="file-upload-section">
                  <label>Maintenance Files</label>
                  <div class="file-upload-group">
                    <div class="file-upload">
                      <label for="maintenanceTemplate">Maintenance Template</label>
                      <input
                        type="file"
                        id="maintenanceTemplate"
                        name="maintenanceTemplate"
                        accept=".pdf,.doc,.docx,.xls,.xlsx"
                      />
                      <span class="file-info">Upload template form</span>
                    </div>
                    <div class="file-upload">
                      <label for="maintenanceInstructions">Maintenance Instructions</label>
                      <input
                        type="file"
                        id="maintenanceInstructions"
                        name="maintenanceInstructions"
                        accept=".pdf,.doc,.docx,.xls,.xlsx"
                      />
                      <span class="file-info">Upload procedure</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
              <h3>Additional Information</h3>
              <div class="form-group">
                <label for="notes">Notes</label>
                <textarea
                  id="notes"
                  name="notes"
                  rows="3"
                  placeholder="Additional notes about this item..."
                ></textarea>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <label class="checkbox-label duplicate-checkbox">
              <input type="checkbox" id="duplicateAfterAdd" name="duplicateAfterAdd" />
              <span class="checkmark"></span>
              Duplicate this item after creating
            </label>
            <div class="action-buttons">
              <button type="button" class="btn-secondary" id="cancelAddItem">Cancel</button>
              <button type="submit" class="btn-primary">
                <span class="btn-text">Add Item</span>
                <div class="btn-loader" style="display: none">
                  <div class="spinner"></div>
                </div>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- NEW Add Item Modal (Dedicated) -->
    <div class="modal-overlay" id="newAddItemModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Inventory Item</h2>
          <button class="modal-close" id="closeNewAddItemModal">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form class="add-item-form" id="newAddItemForm">
          <div class="form-sections">
            <!-- Basic Information -->
            <div class="form-section">
              <h3>Basic Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="newItemType">Item Type *</label>
                  <input
                    type="text"
                    id="newItemType"
                    name="itemType"
                    required
                    placeholder="e.g., Scale, Caliper, Vibration Analyzer"
                  />
                </div>
                <div class="form-group">
                  <label for="newNickname">Nickname</label>
                  <input
                    type="text"
                    id="newNickname"
                    name="nickname"
                    placeholder="e.g., Main Lab Scale"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="newListId">List</label>
                  <select id="newListId" name="listId">
                    <option value="">No lists available</option>
                  </select>
                  <button
                    type="button"
                    id="newCreateListFromForm"
                    class="btn-secondary"
                    style="margin-top: 8px; display: none"
                  >
                    <i class="fas fa-plus"></i> Create New List
                  </button>
                </div>
                <div class="form-group">
                  <!-- spacer -->
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="newLabId">Lab ID/Number</label>
                  <input type="text" id="newLabId" name="labId" placeholder="e.g., LAB-001" />
                </div>
                <div class="form-group">
                  <label for="newMake">Make *</label>
                  <input
                    type="text"
                    id="newMake"
                    name="make"
                    required
                    placeholder="e.g., Mettler Toledo"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="newModel">Model *</label>
                  <input
                    type="text"
                    id="newModel"
                    name="model"
                    required
                    placeholder="e.g., XS205"
                  />
                </div>
                <div class="form-group">
                  <label for="newSerialNumber">Serial Number *</label>
                  <input
                    type="text"
                    id="newSerialNumber"
                    name="serialNumber"
                    required
                    placeholder="e.g., SN123456"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="newCondition">Condition When Received *</label>
                  <select id="newCondition" name="condition" required>
                    <option value="">Select Condition</option>
                    <option value="new">New</option>
                    <option value="used">Used</option>
                    <option value="refurbished">Refurbished</option>
                  </select>
                </div>
                <div class="form-group">
                  <!-- Empty div for spacing -->
                </div>
              </div>
            </div>

            <!-- Dates and Location -->
            <div class="form-section">
              <h3>Dates and Location</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="newDateReceived">Date Received *</label>
                  <input type="date" id="newDateReceived" name="dateReceived" required />
                </div>
                <div class="form-group">
                  <label for="newDatePlacedInService">Date Placed in Service *</label>
                  <input
                    type="date"
                    id="newDatePlacedInService"
                    name="datePlacedInService"
                    required
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="newLocation">Where to Find *</label>
                <input
                  type="text"
                  id="newLocation"
                  name="location"
                  required
                  placeholder="e.g., Main Lab, Field Truck #1, Lab 3 - Bench 2"
                />
              </div>
            </div>

            <!-- Calibration Information -->
            <div class="form-section">
              <h3>Calibration Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="newCalibrationType">Calibration Type *</label>
                  <select id="newCalibrationType" name="calibrationType" required>
                    <option value="">Select Type</option>
                    <option value="in_house">In-House</option>
                    <option value="outsourced">Outsourced</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="newCalibrationDate">Last Calibration Date *</label>
                  <input type="date" id="newCalibrationDate" name="calibrationDate" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="newNextCalibrationDue">Next Calibration Due *</label>
                  <input
                    type="date"
                    id="newNextCalibrationDue"
                    name="nextCalibrationDue"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="newCalibrationInterval">Calibration Interval *</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="newCalibrationInterval"
                      name="calibrationInterval"
                      required
                      min="1"
                      max="365"
                      value="12"
                    />
                    <select id="newCalibrationIntervalType" name="calibrationIntervalType" required>
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="newCalibrationMethod" id="newCalibrationMethodLabel"
                  >Calibration Method *</label
                >
                <input
                  type="text"
                  id="newCalibrationMethod"
                  name="calibrationMethod"
                  required
                  placeholder="e.g., ASTM D4753"
                />
              </div>
            </div>

            <!-- Maintenance Information -->
            <div class="form-section">
              <h3>Maintenance Information</h3>
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="newUseMaintenance" name="useMaintenance" />
                  <span class="checkmark"></span>
                  Include maintenance tracking for this item
                </label>
              </div>

              <div id="newMaintenanceFields" style="display: none">
                <div class="form-row">
                  <div class="form-group">
                    <label for="newMaintenanceDate">Last Maintenance Date</label>
                    <input type="date" id="newMaintenanceDate" name="maintenanceDate" />
                  </div>
                  <div class="form-group">
                    <label for="newMaintenanceDue">Next Maintenance Due</label>
                    <input type="date" id="newMaintenanceDue" name="maintenanceDue" />
                  </div>
                </div>

                <div class="form-group">
                  <label for="newMaintenanceInterval">Maintenance Interval</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="newMaintenanceInterval"
                      name="maintenanceInterval"
                      min="1"
                      max="365"
                      value="6"
                    />
                    <select id="newMaintenanceIntervalType" name="maintenanceIntervalType">
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
              <h3>Additional Information</h3>
              <div class="form-group">
                <label for="newNotes">Notes</label>
                <textarea
                  id="newNotes"
                  name="notes"
                  rows="3"
                  placeholder="Additional notes about this item..."
                ></textarea>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <label class="checkbox-label duplicate-checkbox">
              <input type="checkbox" id="newDuplicateAfterAdd" name="duplicateAfterAdd" />
              <span class="checkmark"></span>
              Duplicate this item after creating
            </label>
            <div class="action-buttons">
              <button type="button" class="btn-secondary" id="newCancelAddItem">Cancel</button>
              <button type="submit" class="btn-primary">
                <span class="btn-text">Add Item</span>
                <div class="btn-loader" style="display: none">
                  <div class="spinner"></div>
                </div>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Item Modal (Dedicated) -->
    <div class="modal-overlay" id="editItemModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Inventory Item</h2>
          <button class="modal-close" id="closeEditItemModal">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form class="edit-item-form" id="editItemForm">
          <div class="form-sections">
            <!-- Basic Information -->
            <div class="form-section">
              <h3>Basic Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="editItemType">Item Type *</label>
                  <input
                    type="text"
                    id="editItemType"
                    name="itemType"
                    required
                    placeholder="e.g., Scale, Caliper, Vibration Analyzer"
                  />
                </div>
                <div class="form-group">
                  <label for="editNickname">Nickname</label>
                  <input
                    type="text"
                    id="editNickname"
                    name="nickname"
                    placeholder="e.g., Main Lab Scale"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="editListId">List</label>
                  <select id="editListId" name="listId">
                    <option value="">No lists available</option>
                  </select>
                </div>
                <div class="form-group">
                  <!-- spacer -->
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="editLabId">Lab ID/Number</label>
                  <input type="text" id="editLabId" name="labId" placeholder="e.g., LAB-001" />
                </div>
                <div class="form-group">
                  <label for="editMake">Make *</label>
                  <input
                    type="text"
                    id="editMake"
                    name="make"
                    required
                    placeholder="e.g., Mettler Toledo"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="editModel">Model *</label>
                  <input
                    type="text"
                    id="editModel"
                    name="model"
                    required
                    placeholder="e.g., XS205"
                  />
                </div>
                <div class="form-group">
                  <label for="editSerialNumber">Serial Number *</label>
                  <input
                    type="text"
                    id="editSerialNumber"
                    name="serialNumber"
                    required
                    placeholder="e.g., SN123456"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="editCondition">Condition When Received *</label>
                  <select id="editCondition" name="condition" required>
                    <option value="">Select Condition</option>
                    <option value="new">New</option>
                    <option value="used">Used</option>
                    <option value="refurbished">Refurbished</option>
                  </select>
                </div>
                <div class="form-group">
                  <!-- Empty div for spacing -->
                </div>
              </div>
            </div>

            <!-- Dates and Location -->
            <div class="form-section">
              <h3>Dates and Location</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="editDateReceived">Date Received *</label>
                  <input type="date" id="editDateReceived" name="dateReceived" required />
                </div>
                <div class="form-group">
                  <label for="editDatePlacedInService">Date Placed in Service *</label>
                  <input
                    type="date"
                    id="editDatePlacedInService"
                    name="datePlacedInService"
                    required
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="editLocation">Where to Find *</label>
                <input
                  type="text"
                  id="editLocation"
                  name="location"
                  required
                  placeholder="e.g., Main Lab, Field Truck #1, Lab 3 - Bench 2"
                />
              </div>
            </div>

            <!-- Calibration Information -->
            <div class="form-section">
              <h3>Calibration Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="editCalibrationType">Calibration Type *</label>
                  <select id="editCalibrationType" name="calibrationType" required>
                    <option value="">Select Type</option>
                    <option value="in_house">In-House</option>
                    <option value="outsourced">Outsourced</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editCalibrationDate">Last Calibration Date *</label>
                  <input type="date" id="editCalibrationDate" name="calibrationDate" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="editNextCalibrationDue">Next Calibration Due *</label>
                  <input
                    type="date"
                    id="editNextCalibrationDue"
                    name="nextCalibrationDue"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="editCalibrationInterval">Calibration Interval *</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="editCalibrationInterval"
                      name="calibrationInterval"
                      required
                      min="1"
                      max="365"
                      value="12"
                    />
                    <select
                      id="editCalibrationIntervalType"
                      name="calibrationIntervalType"
                      required
                    >
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="editCalibrationMethod" id="editCalibrationMethodLabel"
                  >Calibration Method *</label
                >
                <input
                  type="text"
                  id="editCalibrationMethod"
                  name="calibrationMethod"
                  required
                  placeholder="e.g., ASTM D4753"
                />
              </div>
            </div>

            <!-- Maintenance Information -->
            <div class="form-section">
              <h3>Maintenance Information</h3>
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="editUseMaintenance" name="useMaintenance" />
                  <span class="checkmark"></span>
                  Include maintenance tracking for this item
                </label>
              </div>

              <div id="editMaintenanceFields" style="display: none">
                <div class="form-row">
                  <div class="form-group">
                    <label for="editMaintenanceDate">Last Maintenance Date</label>
                    <input type="date" id="editMaintenanceDate" name="maintenanceDate" />
                  </div>
                  <div class="form-group">
                    <label for="editMaintenanceDue">Next Maintenance Due</label>
                    <input type="date" id="editMaintenanceDue" name="maintenanceDue" />
                  </div>
                </div>

                <div class="form-group">
                  <label for="editMaintenanceInterval">Maintenance Interval</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="editMaintenanceInterval"
                      name="maintenanceInterval"
                      min="1"
                      max="365"
                      value="6"
                    />
                    <select id="editMaintenanceIntervalType" name="maintenanceIntervalType">
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
              <h3>Additional Information</h3>
              <div class="form-group">
                <label for="editNotes">Notes</label>
                <textarea
                  id="editNotes"
                  name="notes"
                  rows="3"
                  placeholder="Additional notes about this item..."
                ></textarea>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <div class="action-buttons">
              <button type="button" class="btn-secondary" id="editCancelItem">Cancel</button>
              <button type="submit" class="btn-primary">
                <span class="btn-text">Save Changes</span>
                <div class="btn-loader" style="display: none">
                  <div class="spinner"></div>
                </div>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Duplicate Item Modal -->
    <div class="modal-overlay" id="duplicateItemModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Duplicate Item</h2>
          <button class="modal-close" id="closeDuplicateItemModal">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form class="add-item-form" id="duplicateItemForm">
          <div class="form-sections">
            <!-- Basic Information -->
            <div class="form-section">
              <h3>Basic Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="dupItemType">Item Type *</label>
                  <input
                    type="text"
                    id="dupItemType"
                    name="itemType"
                    required
                    placeholder="e.g., Scale, Caliper, Vibration Analyzer"
                  />
                </div>
                <div class="form-group">
                  <label for="dupNickname">Nickname</label>
                  <input
                    type="text"
                    id="dupNickname"
                    name="nickname"
                    placeholder="e.g., Main Lab Scale"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="dupListId">List</label>
                  <select id="dupListId" name="listId">
                    <option value="">No lists available</option>
                  </select>
                </div>
                <div class="form-group">
                  <!-- spacer -->
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="dupLabId">Lab ID/Number</label>
                  <input type="text" id="dupLabId" name="labId" placeholder="e.g., LAB-001" />
                </div>
                <div class="form-group">
                  <label for="dupMake">Make *</label>
                  <input
                    type="text"
                    id="dupMake"
                    name="make"
                    required
                    placeholder="e.g., Mettler Toledo"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="dupModel">Model *</label>
                  <input
                    type="text"
                    id="dupModel"
                    name="model"
                    required
                    placeholder="e.g., XS205"
                  />
                </div>
                <div class="form-group">
                  <label for="dupSerialNumber">Serial Number *</label>
                  <input
                    type="text"
                    id="dupSerialNumber"
                    name="serialNumber"
                    required
                    placeholder="e.g., SN123456"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="dupCondition">Condition When Received *</label>
                  <select id="dupCondition" name="condition" required>
                    <option value="">Select Condition</option>
                    <option value="new">New</option>
                    <option value="used">Used</option>
                    <option value="refurbished">Refurbished</option>
                  </select>
                </div>
                <div class="form-group">
                  <!-- Empty div for spacing -->
                </div>
              </div>
            </div>

            <!-- Dates and Location -->
            <div class="form-section">
              <h3>Dates and Location</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="dupDateReceived">Date Received *</label>
                  <input type="date" id="dupDateReceived" name="dateReceived" required />
                </div>
                <div class="form-group">
                  <label for="dupDatePlacedInService">Date Placed in Service *</label>
                  <input
                    type="date"
                    id="dupDatePlacedInService"
                    name="datePlacedInService"
                    required
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="dupLocation">Where to Find *</label>
                <input
                  type="text"
                  id="dupLocation"
                  name="location"
                  required
                  placeholder="e.g., Main Lab, Field Truck #1, Lab 3 - Bench 2"
                />
              </div>
            </div>

            <!-- Calibration Information -->
            <div class="form-section">
              <h3>Calibration Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="dupCalibrationType">Calibration Type *</label>
                  <select id="dupCalibrationType" name="calibrationType" required>
                    <option value="">Select Type</option>
                    <option value="in_house">In-House</option>
                    <option value="outsourced">Outsourced</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="dupCalibrationDate">Last Calibration Date *</label>
                  <input type="date" id="dupCalibrationDate" name="calibrationDate" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="dupNextCalibrationDue">Next Calibration Due *</label>
                  <input
                    type="date"
                    id="dupNextCalibrationDue"
                    name="nextCalibrationDue"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="dupCalibrationInterval">Calibration Interval *</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="dupCalibrationInterval"
                      name="calibrationInterval"
                      required
                      min="1"
                      max="365"
                      value="12"
                    />
                    <select id="dupCalibrationIntervalType" name="calibrationIntervalType" required>
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="dupCalibrationMethod">Calibration Method *</label>
                <input
                  type="text"
                  id="dupCalibrationMethod"
                  name="calibrationMethod"
                  required
                  placeholder="e.g., ASTM D4753"
                />
              </div>
            </div>

            <!-- Maintenance Information -->
            <div class="form-section">
              <h3>Maintenance Information</h3>
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="dupUseMaintenance" name="useMaintenance" />
                  <span class="checkmark"></span>
                  Include maintenance tracking for this item
                </label>
              </div>

              <div id="dupMaintenanceFields" style="display: none">
                <div class="form-row">
                  <div class="form-group">
                    <label for="dupMaintenanceDate">Last Maintenance Date</label>
                    <input type="date" id="dupMaintenanceDate" name="maintenanceDate" />
                  </div>
                  <div class="form-group">
                    <label for="dupMaintenanceDue">Next Maintenance Due</label>
                    <input type="date" id="dupMaintenanceDue" name="maintenanceDue" />
                  </div>
                </div>

                <div class="form-group">
                  <label for="dupMaintenanceInterval">Maintenance Interval</label>
                  <div class="interval-input">
                    <input
                      type="number"
                      id="dupMaintenanceInterval"
                      name="maintenanceInterval"
                      min="1"
                      max="365"
                      value="6"
                    />
                    <select id="dupMaintenanceIntervalType" name="maintenanceIntervalType">
                      <option value="days">Days</option>
                      <option value="weeks">Weeks</option>
                      <option value="months" selected>Months</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
              <h3>Additional Information</h3>
              <div class="form-group">
                <label for="dupNotes">Notes</label>
                <textarea
                  id="dupNotes"
                  name="notes"
                  rows="3"
                  placeholder="Additional notes about this item..."
                ></textarea>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <label class="checkbox-label duplicate-checkbox">
              <input type="checkbox" id="duplicateAfterDuplicate" name="duplicateAfterDuplicate" />
              <span class="checkmark"></span>
              Duplicate this item after creating
            </label>
            <div class="action-buttons">
              <button type="button" class="btn-secondary" id="cancelDuplicateItem">Cancel</button>
              <button type="submit" class="btn-primary">
                <span class="btn-text">Create Item</span>
                <div class="btn-loader" style="display: none">
                  <div class="spinner"></div>
                </div>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Item Detail Modal -->
    <div class="modal-overlay" id="itemDetailModal">
      <div class="modal-content large">
        <div class="modal-header">
          <h2 id="itemDetailTitle">Item Details</h2>
          <button class="modal-close" id="closeItemDetailModal">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="item-detail-content" id="itemDetailContent">
          <!-- Item details will be populated here -->
        </div>
      </div>
    </div>

    <!-- Upload Record Modal -->
    <div id="uploadModal" class="modal-overlay">
      <!-- Modal content will be dynamically generated -->
    </div>

    <!-- Create List Modal -->
    <div id="createListModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Create New List</h2>
          <button class="modal-close" onclick="hideCreateListModal()"></button>
        </div>
        <div class="modal-body">
          <form id="createListForm">
            <div class="form-group">
              <label for="listName">List Name</label>
              <input
                type="text"
                id="listName"
                name="listName"
                required
                placeholder="Enter list name"
              />
            </div>

            <div class="form-group">
              <label>List Color</label>
              <div class="color-selection">
                <div class="color-presets">
                  <div class="theme-selector">
                    <label>Theme:</label>
                    <select id="colorTheme" onchange="switchColorTheme()">
                      <option value="dark">Dark Theme (Grey/Black)</option>
                      <option value="light" selected>Light Theme</option>
                      <option value="purple">Purple Theme</option>
                    </select>
                  </div>
                  <h4>Preset Colors</h4>
                  <div class="color-grid" id="colorGrid">
                    <!-- Colors will be populated by JavaScript based on theme -->
                  </div>
                </div>

                <div class="color-custom">
                  <h4>Custom Color</h4>
                  <div class="color-inputs">
                    <div class="color-input-group">
                      <label for="customColor">Background Color</label>
                      <input type="color" id="customColor" name="customColor" value="#6b7280" />
                    </div>
                    <div class="color-input-group">
                      <label for="customTextColor" class="visually-hidden"
                        >Text Color (Auto-generated)</label
                      >
                      <input
                        type="hidden"
                        id="customTextColor"
                        name="customTextColor"
                        value="#ffffff"
                      />
                      <div class="auto-text-color-info">
                        <small>Text color will be automatically chosen for optimal contrast</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" onclick="hideCreateListModal()">
                Cancel
              </button>
              <button type="submit" class="btn-primary">Create List</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit List Modal -->
    <div id="editListModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit List</h2>
          <button class="modal-close" onclick="hideEditListModal()"></button>
        </div>
        <div class="modal-body">
          <form id="editListForm">
            <input type="hidden" id="editListIdHidden" name="editListId" />
            <div class="form-group">
              <label for="editListName">List Name</label>
              <input
                type="text"
                id="editListName"
                name="editListName"
                required
                placeholder="Enter list name"
              />
            </div>

            <div class="form-group">
              <label>List Color</label>
              <div class="color-selection">
                <div class="color-presets">
                  <div class="theme-selector">
                    <label>Theme:</label>
                    <select id="editColorTheme" onchange="switchEditColorTheme()">
                      <option value="dark">Dark Theme (Grey/Black)</option>
                      <option value="light" selected>Light Theme</option>
                      <option value="purple">Purple Theme</option>
                    </select>
                  </div>
                  <h4>Preset Colors</h4>
                  <div class="color-grid" id="editColorGrid">
                    <!-- Colors will be populated by JavaScript based on theme -->
                  </div>
                </div>

                <div class="color-custom">
                  <h4>Custom Color</h4>
                  <div class="color-inputs">
                    <div class="color-input-group">
                      <label for="editCustomColor">Background Color</label>
                      <input
                        type="color"
                        id="editCustomColor"
                        name="editCustomColor"
                        value="#6b7280"
                      />
                    </div>
                    <div class="color-input-group">
                      <label for="editCustomTextColor" class="visually-hidden"
                        >Text Color (Auto-generated)</label
                      >
                      <input
                        type="hidden"
                        id="editCustomTextColor"
                        name="editCustomTextColor"
                        value="#ffffff"
                      />
                      <div class="auto-text-color-info">
                        <small>Text color will be automatically chosen for optimal contrast</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" onclick="hideEditListModal()">
                Cancel
              </button>
              <button type="submit" class="btn-primary">Update List</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Mark Out of Service modal -->
    <div id="modal-oos" class="modal hidden">
      <div class="modal-card">
        <h3>Mark Out of Service</h3>
        <form id="form-oos">
          <input type="hidden" id="oos-item-id" />
          <label class="block text-sm mt-2"
            >Date Out of Service <span class="text-red-400">*</span></label
          >
          <input type="date" id="oos-date" class="input" required />
          <label class="block text-sm mt-3">Reason <span class="text-red-400">*</span></label>
          <input id="oos-reason" class="input" required maxlength="200" />
          <label class="block text-sm mt-3">Reported By <span class="text-red-400">*</span></label>
          <input
            id="oos-reported-by"
            class="input"
            required
            maxlength="100"
            placeholder="Your name"
          />
          <label class="block text-sm mt-3">Notes (optional)</label>
          <textarea id="oos-notes" class="textarea" maxlength="500"></textarea>
          <div class="flex justify-end gap-2 mt-4">
            <button type="button" class="btn btn-ghost" data-close="modal-oos">Cancel</button>
            <button type="submit" class="btn btn-danger">Mark OOS</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Return to Service modal -->
    <div id="modal-rts" class="modal hidden">
      <div class="modal-card">
        <h3>Return to Service</h3>
        <form id="form-rts">
          <input type="hidden" id="rts-item-id" />
          <label class="block text-sm mt-2"
            >Date Returned to Service <span class="text-red-400">*</span></label
          >
          <input type="date" id="rts-date" class="input" required />
          <label class="block text-sm mt-3"
            >Issue Resolved By <span class="text-red-400">*</span></label
          >
          <input
            id="rts-resolved-by"
            class="input"
            required
            maxlength="200"
            placeholder="e.g., Repaired, Replaced part, Cleaned, etc."
          />
          <label class="block text-sm mt-3">Notes (optional)</label>
          <textarea id="rts-notes" class="textarea" maxlength="500"></textarea>
          <div class="flex justify-end gap-2 mt-4">
            <button type="button" class="btn btn-ghost" data-close="modal-rts">Cancel</button>
            <button type="submit" class="btn btn-primary">Return to Service</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Post-Return Service Options modal -->
    <div id="modal-post-return" class="modal hidden">
      <div class="modal-card">
        <h3>Add Records After Return to Service</h3>
        <p class="text-sm opacity-70 mb-4">
          Would you like to add calibration or maintenance records for this item?
        </p>
        <div class="flex flex-col gap-3">
          <button type="button" class="btn btn-primary" id="btn-add-calibration">
            <i class="fas fa-certificate"></i> Add Calibration Record
          </button>
          <button type="button" class="btn btn-secondary" id="btn-add-both-records">
            <i class="fas fa-tools"></i> Add Calibration & Maintenance Records
          </button>
          <button type="button" class="btn btn-ghost" id="btn-not-now">Not At This Moment</button>
        </div>
      </div>
    </div>

    <script src="/app.js?v=oos-ui-2"></script>
  </body>
</html>
